<!DOCTYPE html>
<html lang="it" xmlns:th="http://www.thymeleaf.org">
	<head>
		<meta charset="ISO-8859-1">
		<title>Posts</title>
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" 
		integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" 
		crossorigin="anonymous"/>
		<link rel="stylesheet" href="css/navbar.css">
	</head>
	<body>
	<nav id="navbar">
				<span><a href="/home">Home</a></span>
				<span><a href="/#">Posts</a></span>
				<span><a href="/nuovo-post">Nuovo Post</a></span>
		</nav>
		<h1>Posts</h1>
		
		<div th:inline="text" class="container">
				<div th:each="post : ${posts}" class="card">
					<div id="txt" class="card-body">
					<form th:id="'deleteForm-' + ${post.id}" th:object="${post}" th:action="@{/delete-post/{postId}(postId=${post.id})}">
                <span th:text="${post.id}"></span>
                <!-- Call the JavaScript function when the button is clicked -->
                <button type="button" onclick="deletePost(this)">Delete Post</button>
            </form>
					<p class="card-text" th:text="${post.contenuto}"></p>
				</div>
			</div>
		</div>
		
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" 
		integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" 
		crossorigin="anonymous"></script>
		<script type="text/javascript" src="js/posts.js"></script>
		<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        function deletePost(button) {
            // Find the form associated with the clicked button
            const form = $(button).closest('form');
            
            // Get the form action URL
            const url = form.attr('action');
            
            // Send the DELETE request using AJAX
            $.ajax({
                url: url,
                type: 'DELETE',
                success: function(data) {
                    // Handle success response if needed
                    console.log(data);
                },
                error: function(error) {
                    // Handle error response if needed
                    console.error(error);
                }
                
                
            });
            
            window.location.href = "/posts";
        }
    </script>
		
	</body>
</html>